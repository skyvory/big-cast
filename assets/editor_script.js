"use strict";function getLastLineObjectBySequence(e){if(0!=e){var i=getObjectIndex(line_obj,"sequence",e),t=[],n=0;$.each(line_obj[i].sprite,function(e,i){t.push({sprite_temp_index:n,sprite_id:"new",position_x:i.position_x,position_y:i.position_y,position_z:i.position_z,emphasize:"0",fk_effect_id:i.fk_effect_id,sprite_resource_id:i.sprite_resource_id,sprite_name:i.sprite_name,sprite_file_name:i.sprite_file_name,sprite_character_name:i.sprite_character_name,sprite_figure_name:i.sprite_figure_name,sprite_expression_name:i.sprite_expression_name}),n++});var l={speaker:line_obj[i].speaker,background_resource_id:line_obj[i].background_resource_id,background:line_obj[i].background_name,bgm_resource_id:line_obj[i].bgm_resource_id,bgm:line_obj[i].bgm_name,sprite:t}}else var l={speaker:"",background_resource_id:"",background:"",bgm_resource_id:"",bgm:"",sprite:[]};return l}function callLineData(e,i){i=i||0,current_page=$("#currentpage").val();var t=$.ajax({url:config.base+"index.php/editor/loadLineData",type:"POST",data:{current:current_page,to:e,by:i},dataType:"json",beforeSend:function(){$(".line-list").fadeOut(100),$(".request-loading").show()}});t.done(function(e){if($(".request-loading").hide(),$(".line-list").fadeIn(500),e)if(e.length>0){line_obj=e,head=e[0].sequence,tail=head;var i="";$(".line-list").html(""),$.each(e,function(e,t){if(parseInt(t.sequence)<head&&(head=parseInt(t.sequence)),parseInt(t.sequence)>tail&&(tail=parseInt(t.sequence)),"1"==t.fk_linetype_id)i=' 						<tr> 							<td> 								<form class="form-horizontal text-line-form"> 									<div class="row"> 										<div class="col-md-1"> 											<span class="line-sequence">'+t.sequence+'</span> 											<br /><br /> 											<span class="glyphicon glyphicon-resize-vertical"></span> 										</div> 										<div class="col-md-10"> 											<div class="form-group"> 												<div class="form-inline"> 													<span class="glyphicon glyphicon-user"></span> 													<input type="text" name="speaker" class="form-control input-sm main-line-input" placeholder="speaker" value="'+t.speaker+'" /> 													<span class="glyphicon glyphicon-picture"></span> 													<input type="text" name="background" class="form-control input-sm main-line-input" placeholder="background" value="'+t.background_name+'" /> 													<input type="hidden" name="background_resource_id" value="'+t.background_resource_id+'" /> 													<span class="glyphicon glyphicon-headphones"></span> 													<input type="text" name="bgm" class="form-control input-sm main-line-input" placeholder="bgm" value="'+t.bgm_name+'" /> 													<input type="hidden" name="bgm_resource_id" value="'+t.bgm_resource_id+'" /> 													<span class="glyphicon glyphicon-volume-down"></span> 													<input type="text" name="voice" class="form-control input-sm main-line-input" placeholder="voice" value="'+t.voice_name+'" /> 													<input type="hidden" name="voice_resource_id" value="'+t.voice_resource_id+'" /> 												</div> 											</div> 											<div class="form-group" style="margin-top: -10px; margin-bottom: 5px;"> 												<textarea name="content" class="form-control input-sm" maxlength="200" rows="1" placeholder="text content">'+t.content+'</textarea> 											</div> 											<div class="row"> 												<div class="collapse"> 													<div class="col-md-12"> 														<div class="form-group"> 															<div class="form-inline"> 																<span class="glyphicon glyphicon-bullhorn"></span> 																<input type="text" name="sfx" class="form-control input-xs" placeholder="sfx"  value="'+t.sfx_name+'"/> 																<input type="hidden" name="sfx_resource_id" value="'+t.sfx_resource_id+'" /> 																<span class="glyphicon glyphicon-share-alt"></span> 																<input type="text" name="jumpto" class="form-control input-xs" placeholder="jump to" value="'+t.jumpto_line_label+'" /> 																<input type="hidden" name="jumpto_line_id" value="'+t.jumpto_line_id+'" /> 																<span class="glyphicon glyphicon-tag"></span> 																<input type="text" name="label" class="form-control input-xs" placeholder="label" value="'+t.label+'" /> 															</div> 														</div> 													</div> 												</div> 											</div> 										</div> 										<div class="col-md-1"> 											<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 												<span class="glyphicon glyphicon-remove"></span> 											</button> 											<br /> 											<button type="button" class="btn btn-default btn-xs pull-right line-project-button" tabindex="-1"> 												<span class="glyphicon glyphicon-chevron-right"></span> 											</button> 											<br /> 											<button type="button" class="btn btn-default btn-xs pull-right line-collapse-button" tabindex="-1"> 												<span class="glyphicon glyphicon-option-horizontal"></span> 											</button> 										</div> 									</div> 									<input type="hidden" name="sequence" value="'+t.sequence+'" /> 									<input type="hidden" name="line_id" value="'+t.line_id+'" /> 								</form> 							</td> 						</tr> 						',$(i).appendTo(".line-list");else if("2"==t.fk_linetype_id){i=' 						<tr> 							<td> 								<form class="form-horizontal choice-line-form"> 								<div class="row"> 									<div class="col-md-1"> 										<span class="line-sequence">'+t.sequence+'</span> 										<br /><br /> 										<span class="glyphicon glyphicon-resize-vertical"></span> 									</div> 									<div class="col-md-10">						';var n=0;$.each(t.choice,function(e,t){n++,3==n&&(i+='<div class="collapse">'),i=i+' 											<div class="form-group per-choice" style="margin: 0px 5px 5px 0px;"> 												<label class="col-md-1 control-label">'+n+'</label> 												<div class="col-md-8"> 													<input type="text" name="choice_content" class="form-control input-sm" placeholder="choice" value="'+t.content+'"/> 													<input type="hidden" name="choice_id" value="'+t.choice_id+'" /> 													<input type="hidden" name="choice_temp_index" value="'+t.choice_temp_index+'" /> 												</div> 												<div class="col-md-3" style="margin-left:-25px;"> 													<input type="text" name="choice_jumpto" class="form-control input-sm" placeholder="jump to" value="'+t.jumpto_line_label+'"/> 													<input type="hidden" name="jumpto_line_id" value="'+t.jumpto_line_id+'" /> 												</div> 											</div> 							 '}),i=i+' 											<div class="col-md-4 col-md-offset-7"> 												<input type="text" name="label" class="form-control input-xs" placeholder="label" value="'+t.label+'" /> 											</div> 										</div> 									</div> 									<div class="col-md-1"> 										<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 											<span class="glyphicon glyphicon-remove"></span> 										</button> 										<br /> 										<button type="button" class="btn btn-default btn-xs pull-right line-collapse-button" tabindex="-1"> 											<span class="glyphicon glyphicon-option-horizontal"></span> 										</button> 									</div> 								</div> 								<input type="hidden" name="sequence" value="'+t.sequence+'" /> 								<input type="hidden" name="line_id" value="'+t.line_id+'" /> 								</form> 							</td> 						</tr> 						',$(i).appendTo(".line-list")}else"3"==t.fk_linetype_id?(i=' 						<tr> 							<td> 								<form class="form-horizontal video-line-form"> 									<div class="row"> 										<div class="col-md-1"> 											<span class="line-sequence">'+t.sequence+'</span> 											<br /><br /> 											<span class="glyphicon glyphicon-resize-vertical"></span> 										</div> 										<div class="col-md-2"> 											<span class="glyphicon glyphicon-film pull-left" style="font-size: 5em;"></span> 										</div> 										<div class="col-md-8"> 											<div class="form-group"> 												<div class="col-md-9"> 													<input type="text" name="video" class="form-control input-sm" placeholder="video" value="'+t.video_name+'" /> 													<input type="hidden" name="video_resource_id" value="'+t.video_resource_id+'" /> 												</div> 											</div> 											<div class="collapse"> 												<div class="form-inline"> 													<div class="form-group"> 														<div class="col-md-3"> 															<input type="text" name="jumpto" class="form-control input-xs" placeholder="jump to" value="'+t.jumpto_line_label+'" /> 															<input type="hidden" name="jumpto_line_id" value="'+t.jumpto_line_id+'" /> 														</div> 													</div> 													<div class="form-group"> 														<div class="col-md-3"> 															<input type="text" name="label" class="form-control input-xs" placeholder="label" value="'+t.label+'" /> 														</div> 													</div> 												</div> 											</div> 										</div> 										<div class="col-md-1"> 											<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 												<span class="glyphicon glyphicon-remove"></span> 											</button> 											<br /> 											<button type="button" class="btn btn-default btn-xs pull-right line-collapse-button" tabindex="-1"> 												<span class="glyphicon glyphicon-option-horizontal"></span> 											</button> 										</div> 									</div> 									<input type="hidden" name="sequence" value="'+t.sequence+'" /> 									<input type="hidden" name="line_id" value="'+t.line_id+'" /> 								</form> 							</td> 						</tr> 						',$(i).appendTo(".line-list")):4==t.fk_linetype_id&&(i=' 						<tr> 							<td> 								<form class="form-horizontal end-line-form"> 									<div class="row"> 										<div class="col-md-1"> 											<span class="line-sequence">'+t.sequence+'</span> 											<br /><br /> 											<span class="glyphicon glyphicon-resize-vertical"></span> 										</div> 										<div class="col-md-2"> 											<span class="glyphicon glyphicon-step-forward pull-right" style="font-size: 4em;"></span> 										</div> 										<div class="col-md-8" style="padding-top: 15px;"> 											<p>End mark.</p> 										</div> 										<div class="col-md-1"> 											<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 												<span class="glyphicon glyphicon-remove"></span> 											</button> 											<br /> 										</div> 									</div> 									<input type="hidden" name="sequence" value="'+t.sequence+'" /> 									<input type="hidden" name="line_id" value="'+t.line_id+'" /> 								</form> 							</td> 						</tr> 						',$(i).appendTo(".line-list"))})}else head=0,tail=0,$(".line-list").html(' 					<p class="no-line">No line to display.</p> 					<p class="no-line">You can add lines by using add line buttons.</p> 				')})}function getLineBySequence(e){return line_obj.filter(function(i){return i.sequence==e})}function getLineById(e){return line_obj.filter(function(i){return i.line_id==e})}function getObjectIndex(e,i,t){for(var n=0;n<e.length;n++)if(e[n][i]==t)return n}function sortLineObjectBySequence(){line_obj.sort(function(e,i){return e.sequence-i.sequence})}function saveLine(e){var i=[],t=[],n=[],l=0;$.each(line_obj,function(e,o){if(1==o.fk_linetype_id){i.push({line_id:o.line_id,sequence:o.sequence,label:o.label,speaker:o.speaker,content:o.content,jumpto_line_id:o.jumpto_line_id,fk_linetype_id:o.fk_linetype_id,background_resource_id:o.background_resource_id,bgm_resource_id:o.bgm_resource_id,sfx_resource_id:o.sfx_resource_id,voice_resource_id:o.voice_resource_id,sprite:[]});var a=o.line_id;$.each(line_obj[l].sprite,function(e,i){t.push("new"==i.sprite_id?{sprite_id:i.sprite_id,fk_resource_id:i.sprite_resource_id,position_x:i.position_x,position_y:i.position_y,position_z:i.position_z,emphasize:i.emphasize,fk_effect_id:i.fk_effect_id,fk_line_id:a,sprite_temp_index:i.sprite_temp_index}:{sprite_id:i.sprite_id,fk_resource_id:i.sprite_resource_id,position_x:i.position_x,position_y:i.position_y,position_z:i.position_z,emphasize:i.emphasize,fk_effect_id:i.fk_effect_id,fk_line_id:a})})}else if(2==o.fk_linetype_id){i.push({line_id:o.line_id,sequence:o.sequence,label:o.label,fk_linetype_id:o.fk_linetype_id,choice:[]});var a=o.line_id;$.each(line_obj[l].choice,function(e,i){i.content&&n.push({choice_id:i.choice_id,content:i.content,jumpto_line_id:i.jumpto_line_id,fk_line_id:a,choice_temp_index:i.choice_temp_index})})}else 3==o.fk_linetype_id?i.push({line_id:o.line_id,sequence:o.sequence,label:o.label,jumpto_line_id:o.jumpto_line_id,fk_linetype_id:o.fk_linetype_id,video_resource_id:o.video_resource_id}):4==o.fk_linetype_id&&i.push({line_id:o.line_id,sequence:o.sequence,fk_linetype_id:o.fk_linetype_id});l++});var o=JSON.stringify(delete_obj),a=JSON.stringify(i),s=JSON.stringify(t),c=JSON.stringify(n),r=$.ajax({url:config.base+"index.php/editor/saveLineData",type:"POST",data:{deletedata:o,linedata:a,spritedata:s,choicedata:c},dataType:"json"});r.done(function(i){if(i){var t=i;$.each(t,function(e,i){if("sprite"==i.object){var t=getObjectIndex(line_obj,"line_id",i.fk_line_id),n=getObjectIndex(line_obj[t].sprite,"sprite_temp_index",i.sprite_temp_index);line_obj[t].sprite[n].sprite_id=i.sprite_id;var l=$(".select-line").find("input[name=line_id]").val();if(l==i.fk_line_id){var o=$(".sprite-list tr td form").has("input[name=sprite_temp_index][value="+i.sprite_temp_index+"]");$(o).find("input[name=sprite_id]").val(i.sprite_id)}}else if("choice"==i.object){var t=getObjectIndex(line_obj,"line_id",i.fk_line_id),n=getObjectIndex(line_obj[t].choice,"choice_temp_index",i.choice_temp_index);line_obj[t].choice[n].choice_id=i.choice_id}}),callSuccessNotification("work saved!")}else callErrorNotification("failed to save!");e&&e()})}function saveLabel(e,i){var t=$.ajax({url:config.base+"index.php/editor/saveLabel",type:"POST",data:{line_id:e,label:i},dataType:"html"});t.done(function(){callLabelAutocompleteData()})}function callErrorNotification(e){var i='<div class="alert alert-danger error-notification">'+e+"</div>";$("#notification").append(i).hide().fadeIn(),window.setTimeout(function(){$(".error-notification").fadeTo(500,0,function(){$(this).remove()})},5e3)}function callSuccessNotification(e){var i='<div class="alert alert-success success-notification">'+e+"</div>";$("#notification").append(i).hide().fadeIn(),window.setTimeout(function(){$(".success-notification").fadeTo(500,0,function(){$(this).remove()})},5e3)}function callCharacterAutocompleteData(){var e=$.ajax({url:config.base+"index.php/editor/loadCharacterList",type:"POST",dataType:"json"});e.done(function(e){character_list=e})}function callBackgroundAutocompleteData(){var e=$.ajax({url:config.base+"index.php/editor/loadBackgroundList",type:"POST",dataType:"json"});e.done(function(e){background_name_list=[],$.each(e,function(e,i){background_name_list.push({label:i.name,value:i.resource_id})}),background_list=e})}function callBgmAutocompleteData(){var e=$.ajax({url:config.base+"index.php/editor/loadBgmList",type:"POST",dataType:"json"});e.done(function(e){bgm_name_list=[],$.each(e,function(e,i){bgm_name_list.push({label:i.name,value:i.resource_id})}),bgm_list=e})}function callSfxAutocompleteData(){var e=$.ajax({url:config.base+"index.php/editor/loadSfxList",type:"POST",dataType:"json"});e.done(function(e){sfx_name_list=[],$.each(e,function(e,i){sfx_name_list.push({label:i.name,value:i.resource_id})}),sfx_list=e})}function callVoiceAutocompleteData(){var e=$.ajax({url:config.base+"index.php/editor/loadVoiceList",type:"POST",dataType:"json"});e.done(function(e){voice_name_list=[],$.each(e,function(e,i){voice_name_list.push({label:i.name,value:i.resource_id})}),voice_list=e})}function callLabelAutocompleteData(){var e=$.ajax({url:config.base+"index.php/editor/loadLabelList",type:"POST",dataType:"json"});e.done(function(e){label_name_list=[],$.each(e,function(e,i){label_name_list.push({label:i.label,value:i.line_id})}),label_list=e})}function callSpriteAutocompleteData(){var e=$.ajax({url:config.base+"index.php/editor/loadSpriteList",type:"POST",dataType:"json"});e.done(function(e){sprite_list=[],$.each(e,function(e,i){sprite_list.push({label:i.character_name+" "+i.figure_name+" "+i.expression_name,name:i.name,character_name:i.character_name,figure_name:i.figure_name,expression_name:i.expression_name,resource_id:i.resource_id,file_name:i.file_name,thumb_name:i.thumb_name})})})}function callEffectAutocompleteData(){var e=$.ajax({url:config.base+"index.php/editor/loadEffectList",type:"POST",dataType:"json"});e.done(function(e){effect_name_list=[],$.each(e,function(e,i){effect_name_list.push({label:i.name,value:i.effect_id})}),effect_list=e})}function callVideoAutocompleteData(){var e=$.ajax({url:config.base+"index.php/editor/loadVideoList",type:"POST",dataType:"json"});e.done(function(e){video_name_list=[],$.each(e,function(e,i){video_name_list.push({label:i.name,value:i.resource_id})}),video_list=e})}function compareSpriteIndex(e,i){return e.position_z<i.position_z?-1:e.position_z>i.position_z?1:0}$(document).ready(function(){callLineData("last")});var current_page="last",line_obj=[],delete_obj=[],head=0,tail=0;$(function(){$(".line-list").sortable({axis:"y",stop:function(){var e=head;$(this).children("tr").each(function(){var i=$(this).find("[name=line_id]").val(),t=getObjectIndex(line_obj,"line_id",i);line_obj[t].sequence=e.toString(),$(this).find(".line-sequence").html(e),$(this).find("input[name=sequence]").val(e),e++})}})}),$(function(){$(".draggable").draggable()}),$(function(){$(".sprite-list").sortable({axis:"y",stop:function(){var e=0;$(this).children("tr").each(function(){e++,$(this).find(".sprite-index").html(e)})}})}),$("#addtextlinebutton").click(function(){var e=$(".select-line"),i=$(".line-command-area").find("input:radio[name=line_insert_position]:checked").val();if("after"==i){var t=$(e).find("input[name=sequence]").val();t=parseInt(t);var n=getObjectIndex(line_obj,"sequence",t),l=line_obj[n].fk_linetype_id;if(t){if(1!=l)var o=getLastLineObjectBySequence(0);else var o=getLastLineObjectBySequence(t);var a=t+1,s=$.ajax({url:config.base+"index.php/editor/newLine",type:"POST",data:{linetype:1,sequence:a},dataType:"html",beforeSend:function(){$("#addtextlinebutton").button("loading")}});s.done(function(e){if($("#addtextlinebutton").button("reset"),e){var i=e;if(tail>t)for(var n=tail;n>t;n--){var l=getObjectIndex(line_obj,"sequence",n),s=parseInt(line_obj[l].sequence)+1;line_obj[l].sequence=s.toString()}var c=getObjectIndex(line_obj,"sequence",t)+1,r={line_id:i.toString(),sequence:a.toString(),label:"",speaker:o.speaker,content:"",jumpto_line_id:"",fk_linetype_id:"1",background_resource_id:o.background_resource_id,background_name:o.background,background_file_name:"",bgm_resource_id:o.bgm_resource_id,bgm_name:o.bgm,bgm_file_name:"",sfx_resource_id:"",sfx_name:"",sfx_file_name:"",voice_resource_id:"",voice_name:"",voice_file_name:"",sprite:o.sprite};line_obj.splice(c,0,r),tail++;var p=' 					<tr> 					<td> 					<form class="form-horizontal text-line-form"> 					<div class="row"> 					<div class="col-md-1"> 					<span class="line-sequence"> 					'+a+'</span> 					<br /><br /> 					<span class="glyphicon glyphicon-resize-vertical"></span> 					</div> 					<div class="col-md-10"> 						<div class="form-group"> 							<div class="form-inline"> 								<span class="glyphicon glyphicon-user"></span> 								<input type="text" name="speaker" class="form-control input-sm main-line-input" placeholder="speaker" value="'+o.speaker+'" /> 								<span class="glyphicon glyphicon-picture"></span> 								<input type="text" name="background" class="form-control input-sm main-line-input" placeholder="background" value="'+o.background+'" /> 								<input type="hidden" name="background_resource_id" value="'+o.background_resource_id+'" /> 								<span class="glyphicon glyphicon-headphones"></span> 								<input type="text" name="bgm" class="form-control input-sm main-line-input" placeholder="bgm" value="'+o.bgm+'" /> 								<input type="hidden" name="bgm_resource_id" value="'+o.bgm_resource_id+'" /> 								<span class="glyphicon glyphicon-volume-down"></span> 								<input type="text" name="voice" class="form-control input-sm main-line-input" placeholder="voice" value="" /> 								<input type="hidden" name="voice_resource_id" value="" /> 							</div> 						</div> 						<div class="form-group" style="margin-top: -10px; margin-bottom: 5px;"> 							<textarea name="content" class="form-control input-sm" maxlength="200" rows="1" placeholder="text content"></textarea> 						</div> 						<div class="row"> 							<div class="collapse"> 								<div class="col-md-12"> 									<div class="form-group"> 										<div class="form-inline"> 											<span class="glyphicon glyphicon-bullhorn"></span> 											<input type="text" name="sfx" class="form-control input-xs" placeholder="sfx"  value=""/> 											<input type="hidden" name="sfx_resource_id" value="" /> 											<span class="glyphicon glyphicon-share-alt"></span> 											<input type="text" name="jumpto" class="form-control input-xs" placeholder="jump to" value="" /> 											<input type="hidden" name="jumpto_line_id" value="" /> 											<span class="glyphicon glyphicon-tag"></span> 											<input type="text" name="label" class="form-control input-xs" placeholder="label" value="" /> 										</div> 									</div> 								</div> 							</div> 						</div> 					</div> 					<div class="col-md-1"> 					<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 					<span class="glyphicon glyphicon-remove"></span> 					</button> 					<br /> 					<button type="button" class="btn btn-default btn-xs pull-right line-project-button" tabindex="-1"> 					<span class="glyphicon glyphicon-chevron-right"></span> 					</button> 					<br /> 					<button type="button" class="btn btn-default btn-xs pull-right line-collapse-button" tabindex="-1"> 					<span class="glyphicon glyphicon-option-horizontal"></span> 					</button> 					</div> 					</div> 					<input type="hidden" name="sequence" value="'+a+'" /> 					<input type="hidden" name="line_id" value="'+i+'" /> 					</form> 					</td> 					</tr> 					',d=$(".line-list tr").has("input[name=sequence][value="+t+"]");$(p).insertAfter($(d));var u=head;$(".line-list").children("tr").each(function(){$(this).find("[name=line_id]").val();$(this).find(".line-sequence").html(u),$(this).find("input[name=sequence]").val(u),u++});var m=$(".line-list").find("form").has("input[name=sequence][value="+a+"]"),_=$(m).find("textarea[name=content]");$(_).focus()}})}else callErrorNotification("select line first!")}else if("end"==i){var n=getObjectIndex(line_obj,"sequence",tail),l=-1;if(line_obj.length)var l=line_obj[n].fk_linetype_id;if(1!=l)var o=getLastLineObjectBySequence(0);else var o=getLastLineObjectBySequence(tail);var c=tail+1,s=$.ajax({url:config.base+"index.php/editor/newLine",type:"POST",data:{linetype:1,sequence:c},dataType:"html",beforeSend:function(){$("#addtextlinebutton").button("loading")}});s.done(function(e){if($("#addtextlinebutton").button("reset"),e){var i=e;0==head&&(head++,$(".line-list").html("")),tail++,line_obj.push({line_id:e.toString(),sequence:tail.toString(),label:"",speaker:o.speaker,content:"",jumpto_line_id:"",fk_linetype_id:"1",background_resource_id:o.background_resource_id,background_name:o.background,background_file_name:"",bgm_resource_id:o.bgm_resource_id,bgm_name:o.bgm,bgm_file_name:"",sfx_resource_id:"",sfx_name:"",sfx_file_name:"",voice_resource_id:"",voice_name:"",voice_file_name:"",sprite:o.sprite});var t=' 				<tr> 				<td> 				<form class="form-horizontal text-line-form"> 				<div class="row"> 				<div class="col-md-1"> 				<span class="line-sequence"> 				'+tail+'</span> 				<br /><br /> 				<span class="glyphicon glyphicon-resize-vertical"></span> 				</div> 				<div class="col-md-10"> 				<div class="form-group"> 				<div class="form-inline"> 				<span class="glyphicon glyphicon-user"></span> 				<input type="text" name="speaker" class="form-control input-sm main-line-input" placeholder="speaker" value="'+o.speaker+'" /> 				<span class="glyphicon glyphicon-picture"></span> 				<input type="text" name="background" class="form-control input-sm main-line-input" placeholder="background" value="'+o.background+'" /> 				<input type="hidden" name="background_resource_id" value="'+o.background_resource_id+'" /> 				<span class="glyphicon glyphicon-headphones"></span> 				<input type="text" name="bgm" class="form-control input-sm main-line-input" placeholder="bgm" value="'+o.bgm+'" /> 				<input type="hidden" name="bgm_resource_id" value="'+o.bgm_resource_id+'" /> 				<span class="glyphicon glyphicon-volume-down"></span> 				<input type="text" name="voice" class="form-control input-sm main-line-input" placeholder="voice" value="" /> 				<input type="hidden" name="voice_resource_id" value="" /> 				</div> 				</div> 				<div class="form-group" style="margin-top: -10px; margin-bottom: 5px;"> 				<textarea name="content" class="form-control input-sm" maxlength="200" rows="1" placeholder="text content"> 				</textarea> 				</div> 				<div class="row"> 				<div class="collapse"> 				<div class="col-md-12"> 				<div class="form-group"> 				<div class="form-inline"> 				<span class="glyphicon glyphicon-bullhorn"></span> 				<input type="text" name="sfx" class="form-control input-xs" placeholder="sfx"  value=""/> 				<input type="hidden" name="sfx_resource_id" value="" /> 				<span class="glyphicon glyphicon-share-alt"></span> 				<input type="text" name="jumpto" class="form-control input-xs" placeholder="jump to" value="" /> 				<input type="hidden" name="jumpto_line_id" value="" /> 				<span class="glyphicon glyphicon-tag"></span> 				<input type="text" name="label" class="form-control input-xs" placeholder="label" value="" /> 				</div> 				</div> 				</div> 				</div> 				</div> 				</div> 				<div class="col-md-1"> 				<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 				<span class="glyphicon glyphicon-remove"></span> 				</button> 				<br /> 				<button type="button" class="btn btn-default btn-xs pull-right line-project-button" tabindex="-1"> 				<span class="glyphicon glyphicon-chevron-right"></span> 				</button> 				<br /> 				<button type="button" class="btn btn-default btn-xs pull-right line-collapse-button" tabindex="-1"> 				<span class="glyphicon glyphicon-option-horizontal"></span> 				</button> 				</div> 				</div> 				<input type="hidden" name="sequence" value="'+tail+'" /> 				<input type="hidden" name="line_id" value="'+i+'" /> 				</form> 				</td> 				</tr> 				';$(t).appendTo(".line-list"),window.scrollTo(0,document.body.scrollHeight);var n=$(".line-list").find("form").has("input[name=sequence][value="+tail+"]"),l=$(n).find("textarea[name=content]");$(l).focus()}})}}),$("#addchoicelinebutton").click(function(){var e=$(".select-line"),i=$(".line-command-area").find("input:radio[name=line_insert_position]:checked").val();if("after"==i){var t=$(e).find("input[name=sequence]").val();if(t=parseInt(t)){var n=t+1,l=$.ajax({url:config.base+"index.php/editor/newLine",type:"POST",data:{linetype:2,sequence:n},dataType:"html",beforeSend:function(){$("#addchoicelinebutton").button("loading")}});l.done(function(e){if($("#addchoicelinebutton").button("reset"),e){var i=e;if(tail>t)for(var l=tail;l>t;l--){var o=getObjectIndex(line_obj,"sequence",l),a=parseInt(line_obj[o].sequence)+1;line_obj[o].sequence=a.toString()}var s=getObjectIndex(line_obj,"sequence",t)+1,c={line_id:i.toString(),sequence:n.toString(),label:"",fk_linetype_id:"2",choice:[{choice_id:"new",content:"",jumpto_line_id:"",choice_temp_index:"1"},{choice_id:"new",content:"",jumpto_line_id:"",choice_temp_index:"2"},{choice_id:"new",content:"",jumpto_line_id:"",choice_temp_index:"3"},{choice_id:"new",content:"",jumpto_line_id:"",choice_temp_index:"4"}]};line_obj.splice(s,0,c),tail++;var r=' 					<tr> 						<td> 							<form class="form-horizontal choice-line-form"> 								<div class="row"> 									<div class="col-md-1"> 										<span class="line-sequence">'+n+'</span> 										<br /><br /> 										<span class="glyphicon glyphicon-resize-vertical"></span> 									</div> 									<div class="col-md-10"> 										<div class="form-group per-choice" style="margin: 0px 5px 5px 0px;"> 											<label class="col-md-1 control-label">1</label> 											<div class="col-md-8"> 												<input type="text" name="choice_content" class="form-control input-sm" placeholder="choice" value=""/> 												<input type="hidden" name="choice_id" value="new" /> 												<input type="hidden" name="choice_temp_index" value="1" /> 											</div> 											<div class="col-md-3" style="margin-left:-25px;"> 												<input type="text" name="choice_jumpto" class="form-control input-sm" placeholder="jump_to" value=""/> 												<input type="hidden" name="jumpto_line_id" value="" /> 											</div> 										</div> 										<div class="form-group per-choice" style="margin: 0px 5px 5px 0px;"> 											<label class="col-md-1 control-label">2</label> 											<div class="col-md-8"> 												<input type="text" name="choice_content" class="form-control input-sm" placeholder="choice" value=""/> 												<input type="hidden" name="choice_id" value="new" /> 												<input type="hidden" name="choice_temp_index" value="2" /> 											</div> 											<div class="col-md-3" style="margin-left:-25px;"> 												<input type="text" name="choice_jumpto" class="form-control input-sm" placeholder="jump_to" value=""/> 												<input type="hidden" name="jumpto_line_id" value="" /> 											</div> 										</div> 										<div class="collapse"> 											<div class="form-group per-choice" style="margin: 0px 5px 5px 0px;"> 												<label class="col-md-1 control-label">3</label> 												<div class="col-md-8"> 													<input type="text" name="choice_content" class="form-control input-sm" placeholder="choice" value=""/> 													<input type="hidden" name="choice_id" value="new" /> 													<input type="hidden" name="choice_temp_index" value="3" /> 												</div> 												<div class="col-md-3" style="margin-left:-25px;"> 													<input type="text" name="choice_jumpto" class="form-control input-sm" placeholder="jump_to" value=""/> 													<input type="hidden" name="jumpto_line_id" value="" /> 												</div> 											</div> 											<div class="form-group per-choice" style="margin: 0px 5px 5px 0px;"> 												<label class="col-md-1 control-label">4</label> 												<div class="col-md-8"> 													<input type="text" name="choice_content" class="form-control input-sm" placeholder="choice" value=""/> 													<input type="hidden" name="choice_id" value="new" /> 													<input type="hidden" name="choice_temp_index" value="4" /> 												</div> 												<div class="col-md-3" style="margin-left:-25px;"> 													<input type="text" name="choice_jumpto" class="form-control input-sm" placeholder="jump_to" value=""/> 													<input type="hidden" name="jumpto_line_id" value="" /> 												</div> 											</div> 											<div class="col-md-4 col-md-offset-7"> 												<input type="text" name="label" class="form-control input-xs" placeholder="label" value="" /> 											</div> 										</div> 									</div> 									<div class="col-md-1"> 										<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 											<span class="glyphicon glyphicon-remove"></span> 										</button> 										<br /> 										<button type="button" class="btn btn-default btn-xs pull-right line-collapse-button" tabindex="-1"> 											<span class="glyphicon glyphicon-option-horizontal"></span> 										</button> 									</div> 								</div> 								<input type="hidden" name="sequence" value="'+n+'" /> 								<input type="hidden" name="line_id" value="'+i+'" /> 							</form> 						</td> 					</tr> 					',p=$(".line-list tr").has("input[name=sequence][value="+t+"]");
$(r).insertAfter($(p));var d=head;$(".line-list").children("tr").each(function(){$(this).find("[name=line_id]").val();$(this).find(".line-sequence").html(d),$(this).find("input[name=sequence]").val(d),d++})}})}else callErrorNotification("select line first!")}else if("end"==i){var o=tail+1,l=$.ajax({url:config.base+"index.php/editor/newLine",type:"POST",data:{linetype:2,sequence:o},dataType:"html",beforeSend:function(){$("#addchoicelinebutton").button("loading")}});l.done(function(e){if($("#addchoicelinebutton").button("reset"),e){var i=e;0==head&&(head++,$(".line-list").html("")),tail++,line_obj.push({line_id:i.toString(),sequence:tail.toString(),label:"",fk_linetype_id:"2",choice:[{choice_id:"new",content:"",jumpto_line_id:"",choice_temp_index:"1"},{choice_id:"new",content:"",jumpto_line_id:"",choice_temp_index:"2"},{choice_id:"new",content:"",jumpto_line_id:"",choice_temp_index:"3"},{choice_id:"new",content:"",jumpto_line_id:"",choice_temp_index:"3"}]});var t=' 				<tr> 					<td> 						<form class="form-horizontal choice-line-form"> 							<div class="row"> 								<div class="col-md-1"> 									<span class="line-sequence">'+tail+'</span> 									<br /><br /> 									<span class="glyphicon glyphicon-resize-vertical"></span> 								</div> 								<div class="col-md-10"> 									<div class="form-group per-choice" style="margin: 0px 5px 5px 0px;"> 										<label class="col-md-1 control-label">1</label> 										<div class="col-md-8"> 											<input type="text" name="choice_content" class="form-control input-sm" placeholder="choice" value=""/> 											<input type="hidden" name="choice_id" value="new" /> 											<input type="hidden" name="choice_temp_index" value="1" /> 										</div> 										<div class="col-md-3" style="margin-left:-25px;"> 											<input type="text" name="jumpto" class="form-control input-sm" placeholder="jump_to" value=""/> 											<input type="hidden" name="jumpto_line_id" value="" /> 										</div> 									</div> 									<div class="form-group per-choice" style="margin: 0px 5px 5px 0px;"> 										<label class="col-md-1 control-label">2</label> 										<div class="col-md-8"> 											<input type="text" name="choice_content" class="form-control input-sm" placeholder="choice" value=""/> 											<input type="hidden" name="choice_id" value="new" /> 											<input type="hidden" name="choice_temp_index" value="2" /> 										</div> 										<div class="col-md-3" style="margin-left:-25px;"> 											<input type="text" name="jumpto" class="form-control input-sm" placeholder="jump_to" value=""/> 											<input type="hidden" name="jumpto_line_id" value="" /> 										</div> 									</div> 									<div class="collapse"> 										<div class="form-group per-choice" style="margin: 0px 5px 5px 0px;"> 											<label class="col-md-1 control-label">1</label> 											<div class="col-md-8"> 												<input type="text" name="choice_content" class="form-control input-sm" placeholder="choice" value=""/> 												<input type="hidden" name="choice_id" value="new" /> 												<input type="hidden" name="choice_temp_index" value="3" /> 											</div> 											<div class="col-md-3" style="margin-left:-25px;"> 												<input type="text" name="jumpto" class="form-control input-sm" placeholder="jump_to" value=""/> 												<input type="hidden" name="jumpto_line_id" value="" /> 											</div> 										</div> 										<div class="form-group per-choice" style="margin: 0px 5px 5px 0px;"> 											<label class="col-md-1 control-label">1</label> 											<div class="col-md-8"> 												<input type="text" name="choice_content" class="form-control input-sm" placeholder="choice" value=""/> 												<input type="hidden" name="choice_id" value="new" /> 												<input type="hidden" name="choice_temp_index" value="4" /> 											</div> 											<div class="col-md-3" style="margin-left:-25px;"> 												<input type="text" name="jumpto" class="form-control input-sm" placeholder="jump_to" value=""/> 												<input type="hidden" name="jumpto_line_id" value="" /> 											</div> 										</div> 										<div class="col-md-4 col-md-offset-7"> 											<input type="text" name="label" class="form-control input-xs" placeholder="label" value="" /> 										</div> 									</div> 								</div> 								<div class="col-md-1"> 									<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 										<span class="glyphicon glyphicon-remove"></span> 									</button> 									<br /> 									<button type="button" class="btn btn-default btn-xs pull-right line-collapse-button" tabindex="-1"> 										<span class="glyphicon glyphicon-option-horizontal"></span> 									</button> 								</div> 							</div> 							<input type="hidden" name="sequence" value="'+tail+'" /> 							<input type="hidden" name="line_id" value="'+i+'" /> 						</form> 					</td> 				</tr> 				';$(t).appendTo(".line-list"),window.scrollTo(0,document.body.scrollHeight)}})}}),$("#addvideolinebutton").click(function(){var e=$(".select-line"),i=$(".line-command-area").find("input:radio[name=line_insert_position]:checked").val();if("after"==i){var t=$(e).find("input[name=sequence]").val();if(t=parseInt(t)){var n=t+1,l=$.ajax({url:config.base+"index.php/editor/newLine",type:"POST",data:{linetype:3,sequence:n},dataType:"html",beforeSend:function(){$("#addvideolinebutton").button("loading")}});l.done(function(e){if($("#addvideolinebutton").button("reset"),e){var i=e;if(tail>t)for(var l=tail;l>t;l--){var o=getObjectIndex(line_obj,"sequence",l),a=parseInt(line_obj[o].sequence)+1;line_obj[o].sequence=a.toString()}var s=getObjectIndex(line_obj,"sequence",t)+1,c={line_id:i.toString(),sequence:n.toString(),jumpto_line_id:"",label:"",fk_linetype_id:"3",video_name:"",video_resource_id:""};line_obj.splice(s,0,c),tail++;var r=' 					<tr> 						<td> 							<form class="form-horizontal video-line-form"> 								<div class="row"> 									<div class="col-md-1"> 										<span class="line-sequence">'+n+'</span> 										<br /><br /> 										<span class="glyphicon glyphicon-resize-vertical"></span> 									</div> 									<div class="col-md-2"> 										<span class="glyphicon glyphicon-film pull-left" style="font-size: 5em;"></span> 									</div> 									<div class="col-md-8"> 										<div class="form-group"> 											<div class="col-md-9"> 												<input type="text" name="video" class="form-control input-sm" placeholder="video" value="" /> 												<input type="hidden" name="video_resource_id" value="" /> 											</div> 										</div> 										<div class="collapse"> 											<div class="form-inline"> 												<div class="form-group"> 													<div class="col-md-3"> 														<input type="text" name="jumpto" class="form-control input-xs" placeholder="jump to" value="" /> 														<input type="hidden" name="jumpto_line_id" value="" /> 													</div> 												</div> 												<div class="form-group"> 													<div class="col-md-3"> 														<input type="text" name="label" class="form-control input-xs" placeholder="label" value="" /> 													</div> 												</div> 											</div> 										</div> 									</div> 									<div class="col-md-1"> 										<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 											<span class="glyphicon glyphicon-remove"></span> 										</button> 										<br /> 										<button type="button" class="btn btn-default btn-xs pull-right line-collapse-button" tabindex="-1"> 											<span class="glyphicon glyphicon-option-horizontal"></span> 										</button> 									</div> 								</div> 								<input type="hidden" name="sequence" value="'+n+'" /> 								<input type="hidden" name="line_id" value="'+i+'" /> 							</form> 						</td> 					</tr> 					',p=$(".line-list tr").has("input[name=sequence][value="+t+"]");$(r).insertAfter($(p));var d=head;$(".line-list").children("tr").each(function(){$(this).find("[name=line_id]").val();$(this).find(".line-sequence").html(d),$(this).find("input[name=sequence]").val(d),d++})}})}else callErrorNotification("select line first!")}else if("end"==i){var o=tail+1,l=$.ajax({url:config.base+"index.php/editor/newLine",type:"POST",data:{linetype:3,sequence:o},dataType:"html",beforeSend:function(){$("#addvideolinebutton").button("loading")}});l.done(function(e){if($("#addvideolinebutton").button("reset"),e){var i=e;0==head&&(head++,$(".line-list").html("")),tail++,line_obj.push({line_id:i.toString(),sequence:tail.toString(),jumpto_line_id:"",label:"",fk_linetype_id:"3",video_name:"",video_resource_id:""});var t=' 				<tr> 					<td> 						<form class="form-horizontal video-line-form"> 							<div class="row"> 								<div class="col-md-1"> 									<span class="line-sequence">'+tail+'</span> 									<br /><br /> 									<span class="glyphicon glyphicon-resize-vertical"></span> 								</div> 								<div class="col-md-2"> 									<span class="glyphicon glyphicon-film pull-left" style="font-size: 5em;"></span> 								</div> 								<div class="col-md-8"> 									<div class="form-group"> 										<div class="col-md-9"> 											<input type="text" name="video" class="form-control input-sm" placeholder="video" value="" /> 											<input type="hidden" name="video_resource_id" value="" /> 										</div> 									</div> 								<div class="collapse"> 									<div class="form-inline"> 										<div class="form-group"> 											<div class="col-md-3"> 												<input type="text" name="jumpto" class="form-control input-xs" placeholder="jump to" value="" /> 												<input type="hidden" name="jumpto_line_id" value="" /> 											</div> 										</div> 										<div class="form-group"> 											<div class="col-md-3"> 												<input type="text" name="label" class="form-control input-xs" placeholder="label" value="" /> 											</div> 										</div> 									</div> 								</div> 							</div> 							<div class="col-md-1"> 								<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 									<span class="glyphicon glyphicon-remove"></span> 								</button> 								<br /> 								<button type="button" class="btn btn-default btn-xs pull-right line-collapse-button" tabindex="-1"> 									<span class="glyphicon glyphicon-option-horizontal"></span> 								</button> 							</div> 							</div> 							<input type="hidden" name="sequence" value="'+tail+'" /> 							<input type="hidden" name="line_id" value="'+i+'" /> 						</form> 					</td> 				</tr> 				';$(t).appendTo(".line-list"),window.scrollTo(0,document.body.scrollHeight)}})}}),$("#addendlinebutton").click(function(){var e=$(".select-line"),i=$(".line-command-area").find("input:radio[name=line_insert_position]:checked").val();if("after"==i){var t=$(e).find("input[name=sequence]").val();if(t=parseInt(t)){var n=t+1,l=$.ajax({url:config.base+"index.php/editor/newLine",type:"POST",data:{linetype:4,sequence:n},dataType:"html",beforeSend:function(){$("#addendlinebutton").button("loading")}});l.done(function(e){if($("#addendlinebutton").button("reset"),e){var i=e;if(tail>t)for(var l=tail;l>t;l--){var o=getObjectIndex(line_obj,"sequence",l),a=parseInt(line_obj[o].sequence)+1;line_obj[o].sequence=a.toString()}var s=getObjectIndex(line_obj,"sequence",t)+1,c={line_id:i.toString(),sequence:n.toString(),fk_linetype_id:"4"};line_obj.splice(s,0,c),tail++;var r=' 					<tr> 						<td> 							<form class="form-horizontal end-line-form"> 								<div class="row"> 									<div class="col-md-1"> 										<span class="line-sequence">'+n+'</span> 										<br /><br /> 										<span class="glyphicon glyphicon-resize-vertical"></span> 									</div> 									<div class="col-md-2"> 										<span class="glyphicon glyphicon-step-forward pull-right" style="font-size: 4em;"></span> 									</div> 									<div class="col-md-8" style="padding-top: 15px;"> 										<p>End mark.</p> 									</div> 									<div class="col-md-1"> 										<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 										<span class="glyphicon glyphicon-remove"></span> 										</button> 										<br /> 									</div> 								</div> 								<input type="hidden" name="sequence" value="'+n+'" /> 								<input type="hidden" name="line_id" value="'+i+'" /> 							</form> 						</td> 					</tr> 					',p=$(".line-list tr").has("input[name=sequence][value="+t+"]");$(r).insertAfter($(p));var d=head;$(".line-list").children("tr").each(function(){$(this).find("[name=line_id]").val();$(this).find(".line-sequence").html(d),$(this).find("input[name=sequence]").val(d),d++})}})}else callErrorNotification("select line first!")}else if("end"==i){var o=tail+1,l=$.ajax({url:config.base+"index.php/editor/newLine",type:"POST",data:{linetype:4,sequence:o},dataType:"html",beforeSend:function(){$("#addendlinebutton").button("loading")}});l.done(function(e){if($("#addendlinebutton").button("reset"),e){var i=e;0==head&&(head++,$(".line-list").html("")),tail++,line_obj.push({line_id:i.toString(),sequence:tail.toString(),fk_linetype_id:"4"});var t=' 				<tr> 					<td> 						<form class="form-horizontal end-line-form"> 							<div class="row"> 								<div class="col-md-1"> 									<span class="line-sequence">'+tail+'</span> 									<br /><br /> 									<span class="glyphicon glyphicon-resize-vertical"></span> 								</div> 								<div class="col-md-2"> 									<span class="glyphicon glyphicon-step-forward pull-right" style="font-size: 4em;"></span> 									</div> 								<div class="col-md-8" style="padding-top: 15px;"> 									<p>End mark.</p> 								</div> 								<div class="col-md-1"> 									<button type="button" class="btn btn-danger btn-xs pull-right line-delete-button" tabindex="-1"> 									<span class="glyphicon glyphicon-remove"></span> 									</button> 									<br /> 								</div> 							</div> 							<input type="hidden" name="sequence" value="'+tail+'" /> 							<input type="hidden" name="line_id" value="'+i+'" /> 						</form> 					</td> 				</tr> 				';$(t).appendTo(".line-list"),window.scrollTo(0,document.body.scrollHeight)}})}}),$(".line-list").on("click",".line-collapse-button",function(e){e.preventDefault();var i=$(this.form).find(".collapse");i.collapse("toggle")}),$(".pagination-area").on("click",".collapse-all-button",function(e){e.preventDefault();var i=$(".line-list .collapse");i.collapse("toggle")}),$(".line-list").on("mouseenter",".text-line-form, .form-horizontal",function(){$(this).parent("td").addClass("select-line"),$(this).parent("td").css("background","rgba(150, 148, 148, 0.3)"),$(this).parent("td").parent("tr").siblings("tr").find("td").removeClass("select-line"),$(this).parent("td").parent("tr").siblings("tr").find("td").css("background","");var e=$(this).find("input[name=sequence]").val(),i=getLineBySequence(e);if($(".sprite-list").html(""),i[0].sprite){var t=0;$.each(i[0].sprite,function(e,i){t++;var n=getObjectIndex(effect_list,"effect_id",i.fk_effect_id);if(n)var l=effect_list[n].name;else var l="";if(n=getObjectIndex(sprite_list,"resource_id",i.sprite_resource_id),n>-1)var o=sprite_list[n].label;else var o="";var a="";"1"==i.emphasize&&(a="checked");var s=' 			<tr> 				<td> 					<form class="form-inline sprite-form"> 						<div class="row"> 							<div class="col-md-1"> 								<span class="sprite-index">'+t+'</span> 							</div> 							<div class="col-md-9"> 								<div class="form-group"> 									<div class="checkbox sprite-emphasize-checkbox"> 										<label> 											<input type="checkbox" name="emphasize" '+a+'/> 										</label> 									</div> 									<input type="text" name="sprite" class="form-control input-xs sprite-input sprite-menu" placeholder="sprite" value="'+o+'" /> 										<input type="hidden" name="sprite_resource_id" value="'+i.sprite_resource_id+'" /> 									<br /> 									x <input type="text" name="position_x" class="form-control input-xs sprite-number-input" placeholder="x" value="'+i.position_x+'" /> 									y <input type="text" name="position_y" class="form-control input-xs sprite-number-input" placeholder="y" value="'+i.position_y+'" /> 									z <input type="text" name="position_z" class="form-control input-xs sprite-number-input" placeholder="z" value="'+i.position_z+'" /> 									<input type="text" name="effect" class="form-control input-xs sprite-effect-input" placeholder="transition" value="'+l+'" /> 									<input type="hidden" name="effect_id" value="'+i.fk_effect_id+'" /> 								</div> 							</div> 							<div class="col-md-1"> 								<button type="button" class="btn btn-danger btn-xs pull-left sprite-delete-button" tabindex="-1"> 								<span class="glyphicon glyphicon-remove"> 								</span> 								</button> 							</div> 						</div> 						<input type="hidden" name="sprite_id" value="'+i.sprite_id+'" /> 						<input type="hidden" name="sprite_temp_index" value="'+(t-1)+'" /> 					</form> 				</td> 			</tr> 			';""!=i.sprite_id&&$(s).appendTo(".sprite-list")})}var n=$(this).find("input[name=line_id]").val(),l=getObjectIndex(line_obj,"line_id",n),o=line_obj[l].fk_linetype_id;1!=o?$(".sprite-area").find("input, button").prop("disabled",!0):$(".sprite-area").find("input, button").prop("disabled",!1)}),$("#savebutton").click(function(){var e=$(this).button("loading");sortLineObjectBySequence(),saveLine(function(){e.button("reset")})}),$(".line-list").on("focusout","input[type=text], textarea",function(){var e=$(this.form),i=$(this).attr("name"),t=$(e).find("input[name=line_id]").val(),n=getObjectIndex(line_obj,"line_id",t);switch(i){case"speaker":var l=$(this).val();line_obj[n].speaker=l;break;case"background":for(var o=$(e).find("input[name=background_resource_id]").val(),l=$(this).val(),a=0,s=0;s<background_list.length;s++)o==background_list[s].resource_id&&l==background_list[s].name&&a++;1==a?(line_obj[n].background_resource_id=o,line_obj[n].background_name=l,$(this).css("color","")):""==l?(line_obj[n].background_resource_id="",$(this).css("color","")):(line_obj[n].background_resource_id="",$(this).css("color","rgba(255, 90, 90, 1)"),callErrorNotification("background resource doesn't exist!"));break;case"bgm":var o=$(e).find("input[name=bgm_resource_id]").val(),l=$(this).val(),a=0;$.each(bgm_list,function(e,i){o==i.resource_id&&l==i.name&&a++}),1==a?(line_obj[n].bgm_resource_id=o,line_obj[n].bgm_name=l,$(this).css("color","")):""==l?(line_obj[n].bgm_resource_id="",$(this).css("color","")):(line_obj[n].bgm_resource_id="",$(this).css("color","rgba(255, 90, 90, 1)"),callErrorNotification("bgm resource doesn't exist!"));break;case"content":var l=$(this).val();line_obj[n].content=l;break;case"sfx":var o=$(e).find("input[name=sfx_resource_id]").val(),l=$(this).val(),a=0;$.each(sfx_list,function(e,i){o==i.resource_id&&l==i.name&&a++}),1==a?(line_obj[n].sfx_resource_id=o,$(this).css("color","")):""==l?(line_obj[n].sfx_resource_id="",$(this).css("color","")):(line_obj[n].sfx_resource_id="",$(this).css("color","rgba(255, 90, 90, 1)"),callErrorNotification("sfx resource doesn't exist!"));break;case"voice":var o=$(e).find("input[name=voice_resource_id]").val(),l=$(this).val(),a=0;$.each(voice_list,function(e,i){o==i.resource_id&&l==i.name&&a++}),1==a?(line_obj[n].voice_resource_id=o,$(this).css("color","")):""==l?(line_obj[n].voice_resource_id="",$(this).css("color","")):(line_obj[n].voice_resource_id="",$(this).css("color","rgba(255, 90, 90, 1)"),callErrorNotification("sfx resource doesn't exist!"));break;case"jumpto":var o=$(e).find("input[name=jumpto_line_id]").val(),l=$(this).val(),a=0;$.each(label_list,function(e,i){o==i.line_id&&l==i.label&&a++}),1==a?(line_obj[n].jumpto_line_id=o,$(this).css("color","")):""==l?(line_obj[n].jumpto_line_id="",$(this).css("color","")):(line_obj[n].jumpto_line_id="",$(this).css("color","rgba(255, 90, 90, 1)"),callErrorNotification("label doesn't exist!"));break;case"choice_jumpto":var o=$(this).siblings("input[name=jumpto_line_id]").val(),l=$(this).val(),c=$(this).parent("div").parent(".per-choice").find("input[name=choice_temp_index]").val(),r=getObjectIndex(line_obj[n].choice,"choice_temp_index",c),a=0;$.each(label_list,function(e,i){o==i.line_id&&l==i.label&&a++}),1==a?(line_obj[n].choice[r].jumpto_line_id=o,$(this).css("color","")):""==l?(line_obj[n].choice[r].jumpto_line_id="",$(this).css("color","")):(line_obj[n].choice[r].jumpto_line_id="",$(this).css("color","rgba(255, 90, 90, 1)"),callErrorNotification("label doesn't exist!"));break;case"label":var l=$(this).val();line_obj[n].label=l,saveLabel(t,l);break;case"choice_content":var l=$(this).val(),o=$(this).siblings("input[name=choice_id]").val(),r=getObjectIndex(line_obj[n].choice,"choice_id",o);if("new"==o){var c=$(this).siblings("input[name=choice_temp_index]").val();r=getObjectIndex(line_obj[n].choice,"choice_temp_index",c)}line_obj[n].choice[r].content=l;break;case"video":var o=$(e).find("input[name=video_resource_id]").val(),l=$(this).val(),a=0;$.each(video_list,function(e,i){o==i.resource_id&&l==i.name&&a++}),1==a?(line_obj[n].video_resource_id=o,$(this).css("color","")):""==l?(line_obj[n].video_resource_id="",$(this).css("color","")):(line_obj[n].video_resource_id="",$(this).css("color","rgba(255, 90, 90, 1)"),callErrorNotification("sfx resource doesn't exist!"))}}),$(".sprite-list").on("change","input[type=text], input[type=checkbox]",function(){var e=$(this.form),i=$(this).attr("name"),t=$(".select-line").find("input[name=line_id]").val(),n=$(e).find("input[name=sprite_id]").val(),l=getObjectIndex(line_obj,"line_id",t),o=getObjectIndex(line_obj[l].sprite,"sprite_id",n);switch("new"==n&&(n=$(e).find("input[name=sprite_temp_index]").val(),o=n,o=getObjectIndex(line_obj[l].sprite,"sprite_temp_index",n)),i){case"sprite":var a=$(e).find("input[name=sprite_resource_id]").val(),s=$(this).val(),c=0;$.each(sprite_list,function(e,i){a==i.resource_id&&s==i.label&&c++}),1==c?(line_obj[l].sprite[o].sprite_resource_id=a,line_obj[l].sprite[o].sprite_name=s,$(this).css("color","")):""==s?(line_obj[l].sprite[o].sprite_resource_id="",$(this).css("color","")):(line_obj[l].sprite[o].sprite_resource_id=a,line_obj[l].sprite[o].sprite_name="",$(this).css("color","rgba(255, 90, 90, 1)"),callErrorNotification("sprite resource doesn't exist!"));break;case"position_x":var s=$(this).val();line_obj[l].sprite[o].position_x=s;break;case"position_y":var s=$(this).val();line_obj[l].sprite[o].position_y=s;break;case"position_z":var s=$(this).val();line_obj[l].sprite[o].position_z=s;break;case"emphasize":line_obj[l].sprite[o].emphasize=this.checked?"1":"0";break;case"effect":var a=$(e).find("input[name=effect_id]").val(),s=$(this).val(),c=0;$.each(effect_list,function(e,i){a==i.effect_id&&s==i.name&&c++}),1==c?(line_obj[l].sprite[o].fk_effect_id=a,$(this).css("color","")):""==s?(line_obj[l].sprite[o].fk_effect_id="",$(this).css("color","")):(line_obj[l].sprite[o].fk_effect_id="",$(this).css("color","rgba(255, 90, 90, 1)"),callErrorNotification("transition isn't supported!"))}}),$(".sprite-list").on("keyup","input[name=position_x], input[name=position_y], input[name=position_z], input[name=sprite], input[name=effect]",function(){}),$(".sprite-list").on("keyup","input[type=text]",function(){var e=$(this.form),i=$(this).attr("name"),t=$(".select-line").find("input[name=line_id]").val(),n=$(e).find("input[name=sprite_id]").val(),l=getObjectIndex(line_obj,"line_id",t),o=getObjectIndex(line_obj[l].sprite,"sprite_id",n);switch("new"==n&&(n=$(e).find("input[name=sprite_temp_index]").val(),o=n,o=getObjectIndex(line_obj[l].sprite,"sprite_temp_index",n)),i){case"sprite":var a=($(e).find("input[name=sprite_resource_id]").val(),$(this).val());""==a&&(console.log(line_obj[l].sprite[o].sprite_resource_id),line_obj[l].sprite[o].sprite_resource_id="",line_obj[l].sprite[o].sprite_name="",$(this).css("color",""));break;case"position_x":var a=$(this).val();line_obj[l].sprite[o].position_x=a;break;case"position_y":var a=$(this).val();line_obj[l].sprite[o].position_y=a;break;case"position_z":var a=$(this).val();line_obj[l].sprite[o].position_z=a;break;case"effect":var a=($(e).find("input[name=effect_id]").val(),$(this).val());""==a&&(line_obj[l].sprite[o].fk_effect_id="",$(this).css("color",""))}}),$(".sprite-command-area").on("click","#addspritebutton",function(){var e=$(".select-line").find("input[name=line_id]").val();if(e){var i=getObjectIndex(line_obj,"line_id",e),t=line_obj[i].sprite.length,n=4;if(t>=n)callErrorNotification("can't add more sprite!");else{line_obj[i].sprite.push({sprite_temp_index:t.toString(),sprite_id:"new",fk_resource_id:"",position_x:"0",position_y:"0",position_z:"0",emphasize:"0",fk_effect_id:"",sprite_resource_id:"",sprite_name:"",sprite_file_name:"",sprite_character_name:"",sprite_figure_name:"",sprite_expression_name:""});var l=' 			<tr> 				<td> 					<form class="form-inline sprite-form"> 						<div class="row"> 							<div class="col-md-1"> 								<span class="sprite-index">'+(t+1)+'</span> 							</div> 							<div class="col-md-9"> 								<div class="form-group"> 									<div class="checkbox sprite-emphasize-checkbox"> 										<label> 											<input type="checkbox" name="emphasize" /> 										</label> 									</div> 									<input type="text" name="sprite" class="form-control input-xs sprite-input sprite-menu" placeholder="sprite" value="" /> 									<input type="hidden" name="sprite_resource_id" value="" /> 									<br /> 									x <input type="text" name="position_x" class="form-control input-xs sprite-number-input" placeholder="x" value="0" /> 									y <input type="text" name="position_y" class="form-control input-xs sprite-number-input" placeholder="y" value="0" /> 									z <input type="text" name="position_z" class="form-control input-xs sprite-number-input" placeholder="z" value="0" /> 									<input type="text" name="effect" class="form-control input-xs sprite-effect-input" placeholder="transition" value="" /> 									<input type="hidden" name="effect_id" value="" /> 								</div> 							</div> 							<div class="col-md-1"> 								<button type="button" class="btn btn-danger btn-xs pull-left sprite-delete-button"> 								<span class="glyphicon glyphicon-remove"> 								</span> 								</button> 							</div> 						</div> 						<input type="hidden" name="sprite_id" value="new" /> 						<input type="hidden" name="sprite_temp_index" value="'+t+'" /> 					</form> 				</td> 			</tr> 			';t++,$(l).appendTo(".sprite-list")}}else callErrorNotification("select line first")});var character_list=[],background_name_list=[],background_list=[],bgm_name_list=[],bgm_list=[],voice_name_list=[],voice_list=[],sfx_name_list=[],sfx_list=[],label_name_list=[],label_list=[],sprite_name_list=[],sprite_list=[],effect_name_list=[],effect_list=[],video_name_list=[],video_list=[];$(document).ready(function(){callCharacterAutocompleteData(),callBackgroundAutocompleteData(),callBgmAutocompleteData(),callVoiceAutocompleteData(),callSfxAutocompleteData(),callLabelAutocompleteData(),callSpriteAutocompleteData(),callEffectAutocompleteData(),callVideoAutocompleteData()}),$(".list-refresh-button").click(function(){callCharacterAutocompleteData(),callBackgroundAutocompleteData(),callBgmAutocompleteData(),callVoiceAutocompleteData(),callSfxAutocompleteData(),callLabelAutocompleteData(),callSpriteAutocompleteData(),callEffectAutocompleteData(),callVideoAutocompleteData()}),$(".line-list").on("keydown","input[name=speaker]",function(){$(this).autocomplete({source:character_list,minLength:1,focus:function(){return!1},open:function(){var e=$(this).data("uiAutocomplete").menu.element[0].children[0],i=$(this),t=i.val(),n=$(e).text();0===n.toLowerCase().indexOf(t.toLowerCase())&&(i.val(n),i[0].selectionStart=t.length,i[0].selectionEnd=n.length)}})}),$(".line-list").on("keydown","input[name=background]",function(){$(this).autocomplete({source:background_name_list,minLength:0,focus:function(e,i){$(this);return $(this.form).find("input[name=background_resource_id]").val(i.item.value),!1},open:function(){var e=$(this).data("uiAutocomplete").menu.element[0].children[0],i=$(this),t=i.val(),n=$(e).text();0===n.toLowerCase().indexOf(t.toLowerCase())&&(i.val(n),i[0].selectionStart=t.length,i[0].selectionEnd=n.length)},select:function(e,i){var t=$(this.form);return $(t).find("input[name=background]").val(i.item.label),$(t).find("input[name=background_resource_id]").val(i.item.value),!1},autoFocus:!0})}),$(".line-list").on("keydown","input[name=bgm]",function(){$(this).autocomplete({source:bgm_name_list,minLength:0,focus:function(e,i){$(this);return $(this.form).find("input[name=bgm_resource_id]").val(i.item.value),!1},open:function(){var e=$(this).data("uiAutocomplete").menu.element[0].children[0],i=$(this),t=i.val(),n=$(e).text();0===n.toLowerCase().indexOf(t.toLowerCase())&&(i.val(n),i[0].selectionStart=t.length,i[0].selectionEnd=n.length)},select:function(e,i){$(this);return $(this.form).find("input[name=bgm_resource_id]").val(i.item.value),$(this.form).find("input[name=bgm]").val(i.item.label),!1},autoFocus:!0})}),$(".line-list").on("keydown","input[name=voice]",function(){$(this).autocomplete({source:voice_name_list,minLength:0,focus:function(e,i){$(this);return $(this.form).find("input[name=voice_resource_id]").val(i.item.value),!1},open:function(){var e=$(this).data("uiAutocomplete").menu.element[0].children[0],i=$(this),t=i.val(),n=$(e).text();0===n.toLowerCase().indexOf(t.toLowerCase())&&(i.val(n),i[0].selectionStart=t.length,i[0].selectionEnd=n.length),$(this).autocomplete("widget").css({width:300})},select:function(e,i){$(this);return $(this.form).find("input[name=voice_resource_id]").val(i.item.value),$(this.form).find("input[name=voice]").val(i.item.label),!1},autoFocus:!0})}),$(".line-list").on("keydown","input[name=sfx]",function(){$(this).autocomplete({source:sfx_name_list,minLength:0,focus:function(e,i){$(this);return $(this.form).find("input[name=sfx_resource_id]").val(i.item.value),!1},open:function(){var e=$(this).data("uiAutocomplete").menu.element[0].children[0],i=$(this),t=i.val(),n=$(e).text();0===n.toLowerCase().indexOf(t.toLowerCase())&&(i.val(n),i[0].selectionStart=t.length,i[0].selectionEnd=n.length)},select:function(e,i){$(this);return $(this.form).find("input[name=sfx_resource_id]").val(i.item.value),$(this.form).find("input[name=sfx]").val(i.item.label),!1},autoFocus:!0})}),$(".line-list").on("keydown","input[name=jumpto]",function(){$(this).autocomplete({source:label_name_list,minLength:0,focus:function(e,i){$(this);return $(this).siblings("input[name=jumpto_line_id]").val(i.item.value),!1},open:function(){var e=$(this).data("uiAutocomplete").menu.element[0].children[0],i=$(this),t=i.val(),n=$(e).text();0===n.toLowerCase().indexOf(t.toLowerCase())&&(i.val(n),i[0].selectionStart=t.length,i[0].selectionEnd=n.length)},select:function(e,i){$(this);return $(this).siblings("input[name=jumpto_line_id]").val(i.item.value),$(this).val(i.item.label),!1},autoFocus:!0})}),$(".line-list").on("keydown","input[name=choice_jumpto]",function(){$(this).autocomplete({source:label_name_list,minLength:0,focus:function(e,i){$(this);return $(this).siblings("input[name=jumpto_line_id]").val(i.item.value),!1},open:function(){var e=$(this).data("uiAutocomplete").menu.element[0].children[0],i=$(this),t=i.val(),n=$(e).text();0===n.toLowerCase().indexOf(t.toLowerCase())&&(i.val(n),i[0].selectionStart=t.length,i[0].selectionEnd=n.length)},select:function(e,i){$(this);return $(this).siblings("input[name=jumpto_line_id]").val(i.item.value),$(this).val(i.item.label),!1},autoFocus:!0})}),$(".sprite-list").on("keydown","input[name=sprite]",function(){$(this).autocomplete({source:sprite_list,minLength:0,focus:function(e,i){$(this);return $(this.form).find("input[name=sprite_resource_id]").val(i.item.resource_id),!1},open:function(){$(".ui-menu").css("width","300px");var e=$(this).data("uiAutocomplete").menu.element[0].children[0],i=$(this),t=i.val(),n=$(e).text();
0===n.toLowerCase().indexOf(t.toLowerCase())&&(i.val(n),i[0].selectionStart=t.length,i[0].selectionEnd=n.length),$(this).autocomplete("widget").css({width:"600px",top:"18%",left:"20%","max-height":"600px"})},select:function(e,i){$(this);return $(this.form).find("input[name=sprite_resource_id]").val(i.item.resource_id),$(this.form).find("input[name=sprite]").val(i.item.label),$(this).trigger("change"),!1},autoFocus:!0,position:{my:"right top",at:"left bottom",offset:""}}).autocomplete("instance")._renderItem=function(e,i){return $("<li></li>").append('<a><img src="'+config.base+"resources/"+config.user+"/"+config.project+"/sprite/thumbs/"+i.thumb_name+'" class="autocomplete-sprite-image" />'+i.character_name+" "+i.figure_name+" "+i.expression_name+"</a>").appendTo(e)}}),$(".sprite-list").on("keydown","input[name=effect]",function(){$(this).autocomplete({source:effect_name_list,minLength:0,focus:function(e,i){$(this);return $(this.form).find("input[name=effect_id]").val(i.item.value),!1},open:function(){var e=$(this).data("uiAutocomplete").menu.element[0].children[0],i=$(this),t=i.val(),n=$(e).text();0===n.toLowerCase().indexOf(t.toLowerCase())&&(i.val(n),i[0].selectionStart=t.length,i[0].selectionEnd=n.length)},select:function(e,i){$(this);return $(this.form).find("input[name=effect_id]").val(i.item.value),$(this.form).find("input[name=effect]").val(i.item.label),$(this).trigger("change"),!1},autoFocus:!0})}),$(".line-list").on("keydown","input[name=video]",function(){$(this).autocomplete({source:video_name_list,minLength:0,focus:function(e,i){$(this);return $(this.form).find("input[name=video_resource_id]").val(i.item.value),!1},open:function(){var e=$(this).data("uiAutocomplete").menu.element[0].children[0],i=$(this),t=i.val(),n=$(e).text();0===n.toLowerCase().indexOf(t.toLowerCase())&&(i.val(n),i[0].selectionStart=t.length,i[0].selectionEnd=n.length)},select:function(e,i){$(this);return $(this.form).find("input[name=video_resource_id]").val(i.item.value),$(this.form).find("input[name=video]").val(i.item.label),!1},autoFocus:!0})}),$(".line-list").on("click",".line-delete-button",function(e){e.preventDefault();var i=this.form,t=$(i).find("input[name=line_id]").val(),n=getObjectIndex(line_obj,"line_id",t),l=$.ajax({url:config.base+"index.php/editor/removeLine",type:"POST",data:{lineid:t},dataType:"html"});l.done(function(e){if("1"==e){line_obj.splice(n,1),$(i).closest("tr").remove(),tail--;var t=head;$(".line-list").children("tr").each(function(){var e=$(this).find("[name=line_id]").val(),i=getObjectIndex(line_obj,"line_id",e);line_obj[i].sequence=t.toString(),$(this).find(".line-sequence").html(t),$(this).find("[name=sequence]").val(t),t++})}else callErrorNotification("Delete failed!")})}),$(".sprite-list").on("click",".sprite-delete-button",function(e){e.preventDefault();var i=this.form,t=$(".select-line").find("input[name=line_id]").val(),n=getObjectIndex(line_obj,"line_id",t),l=$(i).find("input[name=sprite_id]").val(),o=getObjectIndex(line_obj[n].sprite,"sprite_id",l);"new"==l&&(l=$(i).find("input[name=sprite_temp_index]").val(),o=getObjectIndex(line_obj[n].sprite,"sprite_temp_index",l)),"new"!=line_obj[n].sprite[o].sprite_id&&delete_obj.push({object:"sprite",id:line_obj[n].sprite[o].sprite_id}),line_obj[n].sprite.splice(o,1),$(i).closest("tr").remove()}),$("#clearspritebutton").click(function(){var e=$(".sprite-list"),i=$(".select-line").find("input[name=line_id]").val(),t=getObjectIndex(line_obj,"line_id",i),n=line_obj[t].sprite.length;line_obj[t].sprite.splice(0,n),$(e).children("tr").remove()}),$(document.body).on("click","input[type=text]",function(){$(this).select()}),$(document.body).on("mouseup",".btn",function(){$(this).blur()}),$("#firstpagebutton").click(function(){callLineData("first"),$("#currentpage").val("1")}),$("#previouspagebutton").click(function(){callLineData("previous");var e=$("#currentpage").val()-1;1>e&&(e=1),$("#currentpage").val(e)}),$("#nextpagebutton").click(function(){callLineData("next");var e=$("#totalpage").text(),i=parseInt($("#currentpage").val())+1;i>e&&(i=e),$("#currentpage").val(i)}),$("#lastpagebutton").click(function(){callLineData("last");var e=$("#totalpage").text();$("#currentpage").val(e)});var delay=function(){var e=0;return function(i,t){clearTimeout(e),e=setTimeout(i,t)}}();$("#currentpage").keyup(function(){var e=$(this).val();delay(function(){callLineData(e)},1e3)}),$("#currentpage").keypress(function(e){13==e.keyCode&&e.preventDefault()}),$("#searchpage").keypress(function(e){var i=$("#searchpage").val();13==e.keyCode&&(e.preventDefault(),callLineData(i,"label"))}),$(document).bind("keydown",function(e){e.ctrlKey&&13==e.which&&$("#addtextlinebutton").trigger("click")}),$(function(){$('[data-toggle="tooltip"]').tooltip()}),$(".line-list").on("mouseover",".line-delete-button, .sprite-delete-button",function(){$(this).tooltip({title:"remove line"}),$(this).tooltip("show")}),$(".line-list").on("mouseover",".line-project-button",function(){$(this).tooltip({title:"basic preview of this line"}),$(this).tooltip("show")}),$(".line-list").on("mouseover",".line-collapse-button",function(){$(this).tooltip({title:"show more details"}),$(this).tooltip("show")}),$(".line-list").on("mouseover","input[name=jumpto]",function(){$(this).tooltip({title:"label where this line proceed to without following sequence order"}),$(this).tooltip("show")}),$(".line-list").on("mouseover","input[name=choice_jumpto]",function(){$(this).tooltip({title:"label where this line proceed to without following sequence order<br />left empty if no jump required",html:!0}),$(this).tooltip("show")}),$(".sprite-list").on("mouseover","input[name=emphasize]",function(){$(this).tooltip({title:"Emphasize this sprite.<br>Particularly and rarely used to emphasize the speaker.<br>Recommended only when people complain about your VN being ambiguous and confusing.",html:!0}),$(this).tooltip("show")}),$(".sprite-list").on("mouseover","input[name=sprite]",function(){$(this).tooltip({title:"sprite's name"}),$(this).tooltip("show")}),$(".sprite-list").on("mouseover","input[name=position_x]",function(){$(this).tooltip({title:"horizontal position"}),$(this).tooltip("show")}),$(".sprite-list").on("mouseover","input[name=position_y]",function(){$(this).tooltip({title:"vertical position"}),$(this).tooltip("show")}),$(".sprite-list").on("mouseover","input[name=position_z]",function(){$(this).tooltip({title:"depth position<br />leave it at 0 for default",html:!0}),$(this).tooltip("show")}),$(".sprite-list").on("mouseover","input[name=effect]",function(){$(this).tooltip({title:"transition default to fade in/out",html:!0}),$(this).tooltip("show")}),$(".play-button").click(function(){var e=window.open(config.base+"index.php/game/play/"+config.project,"_blank");e.focus()});var canvasdisplay=document.getElementsByTagName("canvas")[0];canvasdisplay.width=240,canvasdisplay.height=180;var canvas=new fabric.Canvas("preview");canvas.selection=!1,$(document).ready(function(){var e=new fabric.Text("Preview Pane",{fontSize:20,fontFamily:"Arial",top:canvas.height/2,left:canvas.width/2,originX:"center",originY:"center",fontWeight:"bold",opacity:1,fill:"#777"});e.set("selectable",!1),canvas.add(e)});var path_to_project=config.base+"resources/"+config.user+"/"+config.project+"/";$(".line-list").on("click",".line-project-button",function(){canvas.clear();var e=$(this.form).find("input[name=sequence]").val(),i=getObjectIndex(line_obj,"sequence",e);if(i>-1&&(line_obj[i].sprite.sort(compareSpriteIndex),1==line_obj[i].fk_linetype_id)){var t=getObjectIndex(background_list,"resource_id",line_obj[i].background_resource_id);t>-1&&fabric.Image.fromURL(path_to_project+"background/"+background_list[t].file_name,function(e){var t=e.scale(.3).set({top:0,left:0,opacity:0,angle:0});t.set("selectable",!1),canvas.add(t),t.animate("opacity","1",{onChange:canvas.renderAll.bind(canvas),duration:500,easing:fabric.util.ease.easeOutExpo,onComplete:function(){line_obj[i].sprite.length>0&&$.each(line_obj[i].sprite,function(e,i){var t=getObjectIndex(sprite_list,"resource_id",i.sprite_resource_id);fabric.Image.fromURL(path_to_project+"sprite/"+sprite_list[t].file_name,function(e){var t=e.scale(.3).set({top:30*parseInt(i.position_y),left:30*parseInt(i.position_x),opacity:0,angle:0});canvas.add(t),t.animate("opacity","1",{onChange:canvas.renderAll.bind(canvas),duration:500,easing:fabric.util.ease.easeOutExpo})})})}})})}}),window.onbeforeunload=function(e){var i="Save your work if you haven't done it yet!";return e=e||window.event,e&&(e.returnValue=i),i};